/*! BitShadowMachine v2.0.8 - 2013-11-02 07:11:39 
Vince Allen |Brooklyn, NY | vince@vinceallen.com | @vinceallenvince | License: MIT */
!function(a,b){function c(a,b){var c=a||0,d=b||0;this.x=c,this.y=d}function d(){var a,b;this.name="StatsDisplay",this._active=!0,this._fps=0,this._time=Date.now?Date.now():0,this._timeLastFrame=this._time,this._timeLastSecond=this._time,this._frameCount=0,this.el=document.createElement("div"),this.el.id="statsDisplay",this.el.className="statsDisplay",this.el.style.backgroundColor="black",this.el.style.color="white",this.el.style.fontFamily="Helvetica",this.el.style.padding="0.5em",this.el.style.opacity="0.5",this.el.style.position="absolute",this.el.style.left="0",this.el.style.top="0",this.el.style.width="220px",this._totalElementsValue=null,this._fpsValue=null,a=document.createElement("span"),a.className="statsDisplayLabel",a.style.marginLeft="0.5em",b=document.createTextNode("total elements: "),a.appendChild(b),this.el.appendChild(a),this._totalElementsValue=document.createTextNode("0"),this.el.appendChild(this._totalElementsValue),a=document.createElement("span"),a.className="statsDisplayLabel",a.style.marginLeft="0.5em",b=document.createTextNode("fps: "),a.appendChild(b),this.el.appendChild(a),this._fpsValue=document.createTextNode("0"),this.el.appendChild(this._fpsValue),document.body.appendChild(this.el),this._update(this)}function e(a){this._gradients=[],this._colors=[],this.id=a||e._idCount,e._idCount++}function f(b,d){var e,f=d||{},g=a.Utils.getWindowSize();if(this.gravity=f.gravity||new a.Vector(0,.01),this.c=f.c||.1,this.resolution=f.resolution||4,this.width=f.width/this.resolution||g.width/this.resolution,this.height=f.height/this.resolution||g.height/this.resolution,this.borderRadius=f.borderRadius||0,this.location=f.location||new c((g.width-this.width*this.resolution)/2,(g.height-this.height*this.resolution)/2),this.opacity="undefined"==typeof f.opacity?1:f.opacity,this.zIndex="undefined"==typeof f.zIndex?1:f.zIndex,this.colorMode=f.colorMode||"rgba",this.backgroundColor=f.backgroundColor||"transparent",this.hue=f.hue||0,this.saturation="undefined"==typeof f.saturation?1:f.saturation,this.lightness="undefined"==typeof f.lightness?.5:f.lightness,this.addMenuText="undefined"==typeof f.addMenuText?"":f.addMenuText,e=b?b:document.body,this.el=e,this.name="World",this.el.className=this.name.toLowerCase(),this.id=this.name+a.System.getNewId(),this.pauseStep=!1,e!==document.body){var h=document.createElement("div"),i=h.style;if(h.id="container_"+this.name.toLowerCase(),h.className="worldContainer",i.left=this.location.x+"px",i.top=this.location.y+"px",i.width=this.width*this.resolution+"px",i.height=this.height*this.resolution+"px",i.zIndex=this.zIndex,i.backgroundColor="rgba"===this.colorMode?"rgba("+this.backgroundColor[0]+", "+this.backgroundColor[1]+", "+this.backgroundColor[2]+", "+this.opacity+")":"hsla("+this.hue+", "+100*this.saturation+"%, "+100*this.lightness+"%, "+this.opacity+")",h.appendChild(this.el),!f.noMenu){this.menu=document.createElement("div"),this.menu.id="inputMenu",this.menu.className="inputMenu";var j="'p' = pause | 'r' = reset | 's' = stats | 'h' = hide "+this.addMenuText;this.menu.textContent=j,h.appendChild(this.menu),this.menuHidden=!1}document.body.appendChild(h)}this._pool=[],this.world={}}function g(b){var c=b||{};if(!c.world||"object"!=typeof c.world)throw new Error("Item: A valid instance of the World class is required for a new Item.");this.options=c,this.world=c.world,this.name=c.name||"Item",this.id=this.name+a.System.getNewId(),this.blur=null,this.scale=null}b.BitShadowMachine=a,window.requestAnimFrame=function(){"use strict";return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}();var h={};h.map=function(a,b,c,d,e){var f=(a-b)/(c-b);return f*(e-d)+d},h.getRandomNumber=function(a,b,c){return c?Math.random()*(b-(a-1))+a:Math.floor(Math.random()*(b-(a-1)))+a},h.extend=function(a,b){function c(){}c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a},h.clone=function(a){function b(){}return b.prototype=a,new b},h.getWindowSize=function(){var a={width:!1,height:!1};return"undefined"!=typeof window.innerWidth?(a.width=window.innerWidth,a.height=window.innerHeight):"undefined"!=typeof document.documentElement&&"undefined"!=typeof document.documentElement.clientWidth?(a.width=document.documentElement.clientWidth,a.height=document.documentElement.clientHeight):"undefined"!=typeof document.body&&(a.width=document.body.clientWidth,a.height=document.body.clientHeight),a},h.addEvent=function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c)},h.degreesToRadians=function(a){return"undefined"!=typeof a?2*Math.PI*(a/360):("undefined"!=typeof console&&console.log("Error: Utils.degreesToRadians is missing degrees param."),!1)},h.radiansToDegrees=function(a){return"undefined"!=typeof a?a*(180/Math.PI):("undefined"!=typeof console&&console.log("Error: Utils.radiansToDegrees is missing radians param."),!1)},h.constrain=function(a,b,c){return a>c?c:b>a?b:a},c.VectorSub=function(a,b){return new c(a.x-b.x,a.y-b.y)},c.VectorAdd=function(a,b){return new c(a.x+b.x,a.y+b.y)},c.VectorMult=function(a,b){return new c(a.x*b,a.y*b)},c.VectorDiv=function(a,b){return new c(a.x/b,a.y/b)},c.VectorDistance=function(a,b){return Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2))},c.VectorMidPoint=function(a,b){return c.VectorAdd(a,b).div(2)},c.VectorAngleBetween=function(a,b){var c=a.dot(b),d=Math.acos(c/(a.mag()*b.mag()));return d},c.prototype.name="Vector",c.prototype.clone=function(){function a(){}return a.prototype=this,new a},c.prototype.add=function(a){return this.x+=a.x,this.y+=a.y,this},c.prototype.sub=function(a){return this.x-=a.x,this.y-=a.y,this},c.prototype.mult=function(a){return this.x*=a,this.y*=a,this},c.prototype.div=function(a){return this.x=this.x/a,this.y=this.y/a,this},c.prototype.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},c.prototype.limit=function(a,b){var c=a||null,d=b||null;return c&&this.mag()>c&&(this.normalize(),this.mult(c)),d&&this.mag()<d&&(this.normalize(),this.mult(d)),this},c.prototype.normalize=function(){var a=this.mag();return 0!==a?this.div(a):void 0},c.prototype.distance=function(a){return Math.sqrt(Math.pow(a.x-this.x,2)+Math.pow(a.y-this.y,2))},c.prototype.rotate=function(a){var b=Math.cos(a),c=Math.sin(a),d=this.x,e=this.y;return this.x=d*b-e*c,this.y=d*c+e*b,this},c.prototype.midpoint=function(a){return c.VectorAdd(this,a).div(2)},c.prototype.dot=function(a){return this.z&&a.z?this.x*a.x+this.y*a.y+this.z*a.z:this.x*a.x+this.y*a.y},d.prototype.getFPS=function(){return this._fps},d.prototype._update=function(b){var c=a.System.count();b._time=Date.now?Date.now():0,b._frameCount++,b._time>b._timeLastSecond+1e3&&(b._fps=b._frameCount,b._timeLastSecond=b._time,b._frameCount=0,b._fpsValue.nodeValue=b._fps,b._totalElementsValue.nodeValue=c);var d=function(a){return function(){a._update(a)}}(this);this._active&&window.requestAnimFrame(d)},d.prototype.destroy=function(){this._active=!1,document.getElementById(this.el.id)&&document.body.removeChild(this.el)},e._idCount=0,e.prototype.name="ColorPalette",e.prototype.addColor=function(a){var b,c,d;for(c=h.getRandomNumber(a.min,a.max),d=e._createColorRange(a.startColor,a.endColor,255),b=0;c>b;b++)this._colors.push(d[h.getRandomNumber(0,d.length-1)]);return this},e.prototype.createGradient=function(a){if(this.startColor=a.startColor,this.endColor=a.endColor,this.totalColors=a.totalColors||255,!(this.totalColors>0))throw new Error("ColorPalette: total colors must be greater than zero.");this._gradients.push(e._createColorRange(this.startColor,this.endColor,this.totalColors))},e.prototype.getColor=function(){if(this._colors.length>0)return this._colors[h.getRandomNumber(0,this._colors.length-1)];throw new Error("ColorPalette.getColor: You must add colors via addColor() before using getColor().")},e.prototype.createSampleStrip=function(a){var b,c,d;for(b=0,c=this._colors.length;c>b;b++)d=document.createElement("div"),d.className="color-sample-strip",d.style.background="rgb("+this._colors[b].toString()+")",a.appendChild(d)},e._createColorRange=function(a,b,c){var d,e,f,g,h,i,j,k=[],l=a[0],m=a[1],n=a[2],o=b[0],p=b[1],q=b[2];for(e=o-l,f=p-m,g=q-n,d=0;c>d;d++)h=parseInt(e*d/c,10)+l,i=parseInt(f*d/c,10)+m,j=parseInt(g*d/c,10)+n,k.push([h,i,j]);return k};var i={name:"System"};i.clock=0,i.supportedFeatures={boxshadow:!0,rgba:!0,hsla:!0},i._records={lookup:{},list:[]},i._worlds={lookup:{},list:[],buffers:{}},i._caches={},i._idCount=0,i.mouse={location:new c,lastLocation:new c,velocity:new c},i._resizeTime=0,i.trace=!1,i.totalFrames=-1,i.recordData=!1,i.recordStartFrame=null,i.recordEndFrame=null,i.recordItemProperties={id:!0,name:!0,width:!0,height:!0,scale:!0,location:!0,velocity:!0,angle:!0,minSpeed:!0,maxSpeed:!0,hue:!0,saturation:!0,lightness:!0,color:!0,opacity:!0},i.recordWorldProperties={id:!0,name:!0,width:!0,height:!0,resolution:!0,colorMode:!0},i.recordedData=[],i.init=function(b,c,d,e){var f=b||function(){},g=c||new a.World(document.body),h=d||i.supportedFeatures,j=e?!0:!1;if(!h.boxshadow)throw new Error("BitShadowMachine requires support for CSS Box Shadows.");if(this.supportedFeatures=h,"[object Array]"===Object.prototype.toString.call(g))for(var k=0,l=g.length;l>k;k++)i._addWorld(g[k]);else i._addWorld(g);document.body.onorientationchange=i.updateOrientation,a.Utils.addEvent(window,"resize",function(a){i._resize.call(i,a)}),a.Utils.addEvent(document,"mousemove",function(a){i._recordMouseLoc.call(i,a)}),a.Utils.addEvent(window,"touchstart",function(a){i._recordMouseLoc.call(i,a)}),a.Utils.addEvent(window,"touchmove",function(a){i._recordMouseLoc.call(i,a)}),a.Utils.addEvent(window,"touchend",function(a){i._recordMouseLoc.call(i,a)}),a.Utils.addEvent(window,"devicemotion",function(a){var b,c=i._caches.World.list,d=a.accelerationIncludingGravity.x,e=a.accelerationIncludingGravity.y;for(k=0,l=c.length;l>k;k++)b=c[k],0===window.orientation?(b.gravity.x=d,b.gravity.y=-1*e):-90===window.orientation?(b.gravity.x=e,b.gravity.y=d):(b.gravity.x=-1*e,b.gravity.y=-1*d)}),a.Utils.addEvent(window,"keyup",function(a){i._keyup.call(i,a)}),this._setup=f,this._setup.call(this),j||this._update()},i._addWorld=function(a){i._records.list.push(a),i._worlds.list.push(i._records.list[i._records.list.length-1]),i._worlds.lookup[a.id]=i._records.list[i._records.list.length-1],i._worlds.buffers[a.id]=""},i.add=function(a,b,c){var d,e,f,g,h=b||{},j=this._records.list;if(h.world=c||j[0],g=this.getAllItemsByName(a,h.world._pool),g.length){for(d=0,e=h.world._pool.length;e>d;d++)if(h.world._pool[d].name===a){f=h.world._pool.splice(d,1)[0];break}}else f=BitShadowMachine[a]?new BitShadowMachine[a](h):new BitShadowMachine.Classes[a](h);return f.reset(h),f.init(h),i._records.list.push(f),f},i.start=function(){this._update()},i.updateCache=function(a){var b=i._caches[a.name]||(i._caches[a.name]={lookup:{},list:[]});return b.list[b.list.length]=a,b.lookup[a.id]=!0,b},i._updateCacheLookup=function(a,b){var c=i._caches[a.name];c&&(c.lookup[a.id]=b)},i.count=function(){return this._records.list.length},i.firstWorld=function(){return this._worlds.list.length?this._worlds.list[0]:null},i.lastWorld=function(){return this._worlds.list.length?this._worlds.list[this._worlds.list.length-1]:null},i.firstItem=function(){return this._records.list[0]},i.lastItem=function(){return this._records.list[this._records.list.length-1]},i.getAllWorlds=function(){return i._worlds.list},i.getAllBuffers=function(){return i._worlds.buffers},i._update=function(){var b,c,d,e,f,g=i._records.list,h=i.getAllWorlds(),j=i.firstWorld(),k=i.getAllBuffers(),l="";if(i._resizeTime&&(new Date).getTime()-i._resizeTime>100){for(i._resizeTime=0,b=0,c=h.length;c>b;b++)h[b].pauseStep=!1;j.afterResize&&j.afterResize.call(this)}if(i.totalFrames>-1&&i.clock>=i.totalFrames)return i.totalFramesCallback(),void 0;for(i.trace&&console.time("update"),i.recordData&&(i.recordedData=[{frame:i.clock,world:{},items:[]}]),b=g.length-1;b>=0;b-=1)if(e=g[b],e.step&&!e.world.pauseStep&&e.step(),i.recordData&&"World"!==e.name&&e.opacity){if(!i._checkRecordFrame())continue;i.recordedData[i.recordedData.length-1].items.push({}),i._saveData(i.recordedData[i.recordedData.length-1].items.length-1,e)}for(i.trace&&(console.timeEnd("update"),console.time("render")),b=g.length-1;b>=0;b-=1)if(e=g[b],e.world&&e.location&&e.opacity&&!(e instanceof a.World)){if(l=k[e.world.id],"rgba"===e.world.colorMode&&e.color)l+=i._buildStringRGBA(e);else{if("hsla"!==e.world.colorMode||"undefined"==typeof e.hue||"undefined"==typeof e.saturation||"undefined"==typeof e.lightness)throw new Error("System: current color mode not supported.");l+=i._buildStringHSLA(e)}k[e.world.id]=l}for(b=h.length-1;b>=0;b-=1)j=h[b],d=j.el.style,f=k[j.id],k[h[b].id]="",d.boxShadow=f.substr(0,f.length-1),d.borderRadius=j.borderRadius+"%";i.trace&&console.timeEnd("render"),i.totalFrames>-1&&i._checkRecordFrame()&&(i.frameCompleteCallback(i.clock,i.recordedData[0]),i.recordedData=null),i.clock++,window.requestAnimFrame(i._update)},i.frameCompleteCallback=function(a){console&&console.log("Rendered frame "+a+".")},i.totalFramesCallback=function(){console&&console.log("Rendered "+i.totalFrames+" frames.")},i._buildStringHSLA=function(a){var b=a.world.resolution,c=a.location;return c.x*b+"px "+c.y*b+"px "+a.blur+"px "+b*a.scale+"px "+(i.supportedFeatures.hsla?a.world.colorMode:"hsl")+"("+a.hue+","+100*a.saturation+"%,"+100*a.lightness+"%"+(i.supportedFeatures.hsla?", "+a.opacity:"")+"),"},i._buildStringRGBA=function(a){var b=a.world.resolution,c=a.location;return c.x*b+"px "+c.y*b+"px "+a.blur+"px "+b*a.scale+"px "+(i.supportedFeatures.rgba?a.world.colorMode:"rgb")+"("+a.color[0]+","+a.color[1]+","+a.color[2]+(i.supportedFeatures.rgba?", "+a.opacity:"")+"),"},i._stepForward=function(){var a,b,c,d,e=i._records.list,f=i.getAllWorlds();for(a=0,c=f.length;c>a;a++){for(d=f[a],d.pauseStep=!0,b=e.length-1;b>=0;b-=1)e[b].step&&e[b].step();for(b=e.length-1;b>=0;b-=1)e[b].draw&&e[b].draw()}i.clock++},i._saveData=function(a,b){for(var d in b){if(b.hasOwnProperty(d)&&i.recordItemProperties[d]){var e=b[d];e instanceof c&&(e={x:parseFloat(b[d].x.toFixed(2),10),y:parseFloat(b[d].y.toFixed(2),10)}),"number"==typeof e&&(e=parseFloat(e.toFixed(2),10)),i.recordedData[i.recordedData.length-1].items[a][d]=e}if(!i.recordedData[i.recordedData.length-1].world.id)for(var f in b.world)b.world.hasOwnProperty(f)&&i.recordWorldProperties[f]&&(i.recordedData[i.recordedData.length-1].world[f]=b.world[f])}},i._checkRecordFrame=function(){return i.recordStartFrame&&i.recordEndFrame&&(i.recordStartFrame>i.clock||i.clock>i.recordEndFrame)?!1:!0},i._resetSystem=function(b){var c,d,e,f=i.getAllWorlds();for(c=0,d=f.length;d>c;c++)for(e=f[c],e.pauseStep=!1,e.pauseDraw=!1;e.el.firstChild;)e.el.removeChild(e.el.firstChild);i._caches={},i._destroyAllItems(),i._idCount=0,i.mouse={location:new a.Vector,lastLocation:new a.Vector,velocity:new a.Vector},i._resizeTime=0,b||i._setup.call(i)},i._destroySystem=function(){this._resetSystem(!0),this._destroyAllWorlds(),this.clock=0,this._idCount=0},i._destroyAllItems=function(){var a,b=this._records.list;for(a=b.length-1;a>=0;a--)"World"!==b[a].name&&b.splice(a,1)},i._destroyAllWorlds=function(){var a,b,c=this._records.list;for(a=c.length-1;a>=0;a--)if(b=c[a],"World"===b.name){var d=b.el.parentNode;d.parentNode.removeChild(d),c.splice(a,1)}this._worlds={lookup:{},list:[],buffers:{}}},i.destroyItem=function(a){var b,c,d=this._records.list;for(b=0,c=d.length;c>b;b++)if(d[b].id===a.id){d[b].world._pool[d[b].world._pool.length]=d.splice(b,1)[0],i._updateCacheLookup(a,!1);break}},i.getAllItemsByName=function(a,b){var c,d,e=[],f=b||this._records.list;for(c=0,d=f.length;d>c;c++)f[c].name===a&&(e[e.length]=f[c]);return e},i.getAllItemsByAttribute=function(a,b){var c,d,e=[],f=this._records.list,g="undefined"!=typeof b?b:null;for(c=0,d=f.length;d>c;c++)if("undefined"!=typeof f[c][a]){if(null!==g&&f[c][a]!==g)continue;e[e.length]=f[c]}return e},i.updateItemPropsByName=function(a,b){var c,d,e,f=this.getAllItemsByName(a);for(c=0,d=f.length;d>c;c++)for(e in b)b.hasOwnProperty(e)&&(f[c][e]=b[e]);return f},i.getItem=function(a){var b,c,d=this._records.list;for(b=0,c=d.length;c>b;b+=1)if(d[b].id===a)return d[b];return null},i.updateItem=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},i._resize=function(){var b,c,d,e,f=this._records.list,g=a.Utils.getWindowSize(),h=i.getAllWorlds();for(b=0,c=f.length;c>b;b++)d=f[b],"World"!==d.name&&d.world.boundToWindow&&d.location&&(d.location.x=g.width*(d.location.x/d.world.width),d.location.y=g.height*(d.location.y/d.world.height));for(b=0,c=h.length;c>b;b++)e=h[b],e.boundToWindow&&(e.bounds=[0,g.width,g.height,0],e.width=g.width,e.height=g.height,e.location=new a.Vector(g.width/2,g.height/2))},i._keyup=function(a){var b,c,d,e=this.getAllWorlds();switch(a.keyCode){case 39:i._stepForward();break;case 80:for(b=0,c=e.length;c>b;b++)d=e[b],d.pauseStep=!d.pauseStep;break;case 82:i._resetSystem();break;case 83:i._toggleStats();break;case 72:i.firstWorld().toggleMenu()}},i.getNewId=function(){return this._idCount++,this._idCount},i._recordMouseLoc=function(b){var c,d=this.firstWorld(),e=a.Utils.map;this.mouse.lastLocation.x=this.mouse.location.x,this.mouse.lastLocation.y=this.mouse.location.y,b.changedTouches&&(c=b.changedTouches[0]),b.pageX&&b.pageY?(this.mouse.location.x=e(b.pageX,0,window.innerWidth,0,d.width),this.mouse.location.y=e(b.pageY,0,window.innerHeight,0,d.height)):b.clientX&&b.clientY?(this.mouse.location.x=e(b.clientX,0,window.innerWidth,0,d.width),this.mouse.location.y=e(b.clientY,0,window.innerHeight,0,d.height)):c&&(this.mouse.location.x=c.pageX,this.mouse.location.y=c.pageY),this.mouse.velocity.x=this.mouse.lastLocation.x-this.mouse.location.x,this.mouse.velocity.y=this.mouse.lastLocation.y-this.mouse.location.y},i.updateOrientation=function(){setTimeout(function(){i._records.list[0]._setBounds()},500)},i._toggleStats=function(){i._statsDisplay?i._statsDisplay&&i._statsDisplay._active?i._statsDisplay.destroy():i._statsDisplay&&!i._statsDisplay._active&&(i._statsDisplay=new a.StatsDisplay):i._statsDisplay=new a.StatsDisplay},f.prototype.toggleMenu=function(){return this.menuHidden=!this.menuHidden,this.menuHidden?(this.menu.style.visibility="hidden",void 0):(this.menu.style.visibility="visible",void 0)},g.prototype.init=function(){console&&console.log("init is not implemented.")},g.prototype.reset=function(a){var b,c=a||{};for(b in c)c.hasOwnProperty(b)&&(this[b]=c[b]);this.blur=c.blur||0,this.scale="undefined"==typeof c.scale?1:c.scale,this.opacity="undefined"==typeof c.opacity?1:c.opacity,this.color=c.color||[0,0,0]},a.Utils=h,a.Vector=c,a.StatsDisplay=d,a.ColorPalette=e,a.System=i,a.World=f,a.Item=g}({},function(){return this}());